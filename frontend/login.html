<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Secure Feedback System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  height:100vh;
  background: linear-gradient(120deg, #1d2671, #c33764);
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:'Segoe UI', sans-serif;
}

.login-box{
  background:#ffffff;
  width:100%;
  max-width:420px;
  padding:35px;
  border-radius:18px;
  box-shadow:0 25px 50px rgba(0,0,0,0.3);
  animation:fadeIn 0.8s ease;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(20px);}
  to{opacity:1; transform:translateY(0);}
}

.form-control{ border-radius:10px; padding:12px; }

.btn-login{
  background: linear-gradient(120deg, #1d2671, #c33764);
  color:white;
  border:none;
  padding:12px;
  border-radius:12px;
  font-weight:600;
}

.btn-home{
  border-radius:12px;
  padding:10px;
  font-weight:600;
}

.captcha-box{
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:12px;
  margin-bottom:15px;
}

.captcha-code{
  font-weight:700;
  letter-spacing:3px;
  background:#f3f4f6;
  padding:6px 12px;
  border-radius:8px;
}

.refresh{ cursor:pointer; color:#2563eb; margin-left:10px; }

.alert{ animation:shake 0.4s; }

@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-5px);}
  50%{transform:translateX(5px);}
  75%{transform:translateX(-5px);}
  100%{transform:translateX(0);}
}

.signup{
  font-size:14px;
  margin-top:12px;
}

.signup a{
  color:#1d2671;
  font-weight:600;
  text-decoration:none;
}
</style>
</head>

<body>

<div class="login-box">

  <h3 class="text-center mb-3">Secure Login</h3>

  <div id="alertBox" class="alert alert-danger d-none text-center">
    ⚠️ Invalid username, password, or captcha
  </div>

  <input id="user" class="form-control mb-3" placeholder="Username">
  <input id="pass" type="password" class="form-control mb-3" placeholder="Password">

  <div class="captcha-box">
    <div class="d-flex align-items-center mb-2">
      <span id="captcha" class="captcha-code"></span>
      <span class="refresh" onclick="generateCaptcha()">⟳</span>
    </div>
    <input id="captchaInput" class="form-control" placeholder="Enter captcha (case-sensitive)">
  </div>

  <button id="loginBtn" class="btn btn-login w-100" onclick="login()">
    <span id="btnText">Login</span>
    <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
  </button>

  <!-- ✅ SIGN UP LINK -->
  <div class="signup text-center">
    Not registered? <a href="signup.html">Sign up</a>
  </div>

  <!-- ✅ HOME BUTTON -->
  <button class="btn btn-outline-secondary btn-home w-100 mt-2" onclick="goHome()">
    ⬅ Go back to Home Page
  </button>

</div>

<script>
let currentCaptcha="";
const role=localStorage.getItem("role");

function generateCaptcha(){
  currentCaptcha=Math.random().toString(36).substring(2,8);
  captcha.innerText=currentCaptcha;
}

function login(){
  if(captchaInput.value.trim()!==currentCaptcha){
    alertBox.classList.remove("d-none");
    generateCaptcha();
    return;
  }

  fetch("http://127.0.0.1:5000/login",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username:user.value,password:pass.value})
  })
  .then(r=>{if(!r.ok) throw 0;})
  .then(()=>window.location.href=role==="student"?"feedback.html":"admin.html")
  .catch(()=>alertBox.classList.remove("d-none"));
}

function goHome(){
  window.location.href="index.html";
}

generateCaptcha();
</script>

</body>
</html>