<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Insights Assistant</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  min-height:100vh;
  background: linear-gradient(120deg, #1d2671, #c33764);
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:'Segoe UI', sans-serif;
}

.chat-wrapper{
  background:#ffffff;
  width:100%;
  max-width:650px;
  border-radius:22px;
  box-shadow:0 30px 60px rgba(0,0,0,0.35);
  overflow:hidden;
}

.chat-header{
  padding:20px;
  border-bottom:1px solid #eee;
}

.chat-header h5{
  margin:0;
  font-weight:700;
  color:#1d2671;
}

.chat-body{
  padding:20px;
  height:300px;
  overflow-y:auto;
  background:#f8f9fa;
}

.msg{
  max-width:85%;
  padding:10px 14px;
  border-radius:12px;
  margin-bottom:10px;
  font-size:14px;
  white-space:pre-line;
}

.user{
  background:#e7efff;
  color:#1d2671;
  margin-left:auto;
}

.bot{
  background:#e9f7ef;
  color:#14532d;
}

.chat-input{
  padding:15px;
  border-top:1px solid #eee;
}

.btn-send{
  background: linear-gradient(120deg, #1d2671, #c33764);
  color:white;
  border:none;
  border-radius:10px;
  padding:10px 20px;
  font-weight:600;
}

.privacy{
  font-size:13px;
  color:#6c757d;
  text-align:center;
  padding:10px;
  border-top:1px solid #eee;
}
</style>
</head>

<body>

<div class="chat-wrapper">

  <div class="chat-header">
    <h5>Feedback Insights Assistant</h5>
    <p class="text-muted mb-0">AI-powered academic analytics</p>
  </div>

  <div id="chat" class="chat-body">
    <div class="msg bot">
      Hello! Ask me about student feedback trends, sentiment, or issues.
    </div>
  </div>

  <div class="chat-input d-flex gap-2">
    <input id="question" class="form-control" placeholder="Ask a question...">
    <button class="btn-send" onclick="askBot()">Ask</button>
  </div>

  <div class="privacy">
    ðŸ”’ Only aggregated data is used. No individual feedback is exposed.
  </div>

</div>

<script>
function addMessage(text,type){
  const chat=document.getElementById("chat");
  const div=document.createElement("div");
  div.className="msg "+type;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function askBot(){
  const q = question.value.trim();
  if(!q) return;

  addMessage(q,"user");
  question.value="";

  addMessage("Analyzing feedback data...","bot");

  fetch("http://127.0.0.1:5000/chatbot")
  .then(r=>r.json())
  .then(summary=>{
    let reply = "";

    reply += "ðŸ“Š Total Feedback: " + summary.feedback_count + "\n";
    reply += "ðŸ˜Š Average Sentiment: " + summary.average_sentiment + "\n\n";

    if(summary.top_issues && summary.top_issues.length > 0){
      reply += "âš ï¸ Top Issues:\n";
      summary.top_issues.forEach(i=>{
        reply += "- " + i[0] + " (" + i[1] + ")\n";
      });
    }

    if(summary.recommendations && summary.recommendations.length > 0){
      reply += "\nðŸ’¡ Recommendations:\n";
      summary.recommendations.forEach(r=>{
        reply += "- " + r + "\n";
      });
    }

    setTimeout(()=>addMessage(reply,"bot"),500);
  })
  .catch(err=>{
    addMessage("Error connecting to AI backend.","bot");
  });
}
</script>

</body>
</html>
